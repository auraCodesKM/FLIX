{% extends 'base_home.html' %}
{% block body %}
<header>
    <div class="logo">IMDb</div>
    <nav>
        <a href="{{ url_for('home') }}">Home</a>
        <a href="{{ url_for('my_ratings') }}">My Ratings</a>
        <a href="{{ url_for('logout') }}">Logout</a>
    </nav>
</header>

<main class="movie-detail">
    <div class="movie-content">
        <div class="movie-poster">
            <img src="{{ movie.image_url }}" alt="{{ movie.title }}">
        </div>
        <div class="movie-info">
            <h1>{{ movie.title }}</h1>
            <p class="release-date">Released: {{ movie.release_date.strftime('%B %d, %Y') }}</p>
            <p class="description">{{ movie.description }}</p>
            
            {% if movie.ratings %}
            <div class="average-rating">
                Average Rating: {{ "%.1f"|format(movie.ratings|map(attribute='rating')|sum / movie.ratings|length) }}/10
                ({{ movie.ratings|length }} ratings)
            </div>
            {% endif %}
            
            <div class="rating-section">
                <h2>{% if user_rating %}Update your rating{% else %}Rate this movie{% endif %}</h2>
                <form method="POST">
                    {{ form.hidden_tag() }}
                    <div class="rating-stars">
                        {% for i in range(1, 11) %}
                        <input type="radio" id="star{{ i }}" name="rating" value="{{ i }}"
                               {% if form.rating.data == i %}checked{% endif %}>
                        <label for="star{{ i }}">{{ i }}</label>
                        {% endfor %}
                    </div>
                    {% if form.rating.errors %}
                        {% for error in form.rating.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    {% endif %}
                    
                    {{ form.review(placeholder="Write your review here...") }}
                    {% if form.review.errors %}
                        {% for error in form.review.errors %}
                            <span class="error">{{ error }}</span>
                        {% endfor %}
                    {% endif %}
                    
                    {{ form.submit(class="submit-rating") }}
                </form>
            </div>

            <!-- User Reviews Section -->
            <div class="user-reviews-section">
                <h2>User Reviews</h2>
                {% if movie.ratings %}
                    {% for rating in movie.ratings|sort(attribute='date_posted', reverse=true) %}
                    <div class="review-card">
                        <div class="review-header">
                            <span class="reviewer-name">{{ rating.author.name }}</span>
                            <span class="review-rating">{{ rating.rating }}/10</span>
                            <span class="review-date">{{ rating.date_posted.strftime('%B %d, %Y') }}</span>
                        </div>
                        <div class="review-content">
                            {{ rating.review }}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="no-reviews">No reviews yet. Be the first to review!</p>
                {% endif %}
            </div>
        </div>
    </div>
</main>
{% endblock %} 